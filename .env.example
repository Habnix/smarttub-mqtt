# SmartTub MQTT Bridge Configuration
# Copy this file to .env and fill in your actual credentials
# DO NOT commit .env to version control

# ==============================================================================
# SmartTub API Credentials (REQUIRED)
# ==============================================================================
SMARTTUB_EMAIL=user@example.com
SMARTTUB_PASSWORD=changeme
# SMARTTUB_DEVICE_ID=  # Optional: Auto-detected from API if not set

# ==============================================================================
# MQTT Broker Configuration (REQUIRED)
# ==============================================================================
MQTT_BROKER_URL=mqtt://localhost:1883
MQTT_USERNAME=
MQTT_PASSWORD=
MQTT_BASE_TOPIC=smarttub-mqtt

# ==============================================================================
# Discovery & Feature Detection
# ==============================================================================
# Enable initial discovery on first startup (default: true)
# After first successful discovery, this will be automatically set to false
CHECK_SMARTTUB=true

# Discovery intervals (seconds)
DISCOVERY_REFRESH_INTERVAL=3600  # Re-run discovery every hour (default: 3600)
CAPABILITY_REFRESH_INTERVAL=300  # Refresh capabilities every 5 minutes (default: 300)

# Background Discovery (v0.3.0)
# Controls automatic discovery at startup
# Options: off (default), startup_quick, startup_full, startup_yaml
# - off: Manual discovery only via WebUI (http://localhost:8080/discovery) or MQTT
# - startup_quick: Quick discovery (~5 min) on startup - tests 4 common modes
# - startup_full: Full discovery (~20 min) on startup - tests all 18 modes
# - startup_yaml: Load saved results only (instant) - publishes from discovered_items.yaml
DISCOVERY_MODE=off

# ==============================================================================
# Polling & State Management
# ==============================================================================
# How often to poll SmartTub API for state updates (seconds, default: 30)
POLL_INTERVAL=30

# Minimum time between polls to avoid API rate limits (seconds, default: 5)
POLL_MIN_INTERVAL=5

# Delay after sending a command before fetching updated state (seconds, default: 2.5)
# The SmartTub Cloud API needs time to process commands and update its state.
# Range: 0.5 - 10.0 seconds. Increase if state updates are missing, decrease for faster feedback.
STATE_UPDATE_DELAY_SECONDS=2.5

# ==============================================================================
# Web UI Configuration
# ==============================================================================
# Enable Web UI (default: true)
WEB_ENABLED=true

# Web UI listen address and port
WEB_HOST=0.0.0.0
WEB_PORT=8080

# Basic Authentication (leave empty to disable auth)
WEB_AUTH_ENABLED=false
WEB_AUTH_USERNAME=admin
WEB_AUTH_PASSWORD=changeme

# ==============================================================================
# Logging Configuration
# ==============================================================================
LOG_LEVEL=info  # debug, info, warning, error, critical

# Log file directory
# Docker: /logs (mapped to ./logs on host)
# Standalone: /var/log/smarttub-mqtt
LOG_DIR=/logs

# Log rotation settings
LOG_MAX_SIZE_MB=5        # Maximum log file size before rotation (default: 5)
LOG_MAX_FILES=5          # Maximum number of log files to keep (default: 5)
LOG_COMPRESS=true        # Compress rotated logs (default: true)

# MQTT log publishing
LOG_MQTT_ENABLED=true    # Publish logs to MQTT (default: true)
LOG_MQTT_LEVEL=warning   # Minimum level for MQTT logs (default: warning)

# ==============================================================================
# Safety & Command Verification
# ==============================================================================
# Time to wait after sending a command before verification (seconds, default: 12)
SAFETY_POST_COMMAND_WAIT_SECONDS=12

# How many times to verify command execution (0 = no verification, default: 3)
SAFETY_COMMAND_VERIFICATION_RETRIES=3

# Timeout for command execution (seconds, default: 7)
SAFETY_COMMAND_TIMEOUT_SECONDS=7

# Maximum number of command retries on failure (default: 2)
SAFETY_COMMAND_MAX_RETRIES=2

# ==============================================================================
# Advanced Configuration
# ==============================================================================
# Path to YAML config file (optional, overrides .env settings)
CONFIG_FILE=/config/smarttub.yaml

# MQTT connection settings
MQTT_KEEPALIVE=60        # MQTT keepalive interval (seconds, default: 60)
MQTT_QOS=1               # MQTT Quality of Service (0, 1, or 2, default: 1)
MQTT_RETAIN=true         # Retain state messages (default: true)

# Timezone for timestamps (default: UTC)
TIMEZONE=UTC
